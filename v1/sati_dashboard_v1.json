{
  "displayName": "[SATI] HTTP/S Load Balancer Backend Services Monitoring",
  "dashboardFilters": [],
  "description": "This dashboard has 10 charts for the related [HTTP/s load balancer metrics](https://cloud.google.com/monitoring/api/metrics_gcp_i_o#gcp-loadbalancing), including Backend Request Count by Code Class, Backend Request Count by Path, Error Rate, Error Count by Path and Code, Backend Latency, Backend P50 Latency by Path, Backend Request Bytes, Backend Request Bytes by Path, Backend Response Bytes and Backend Response Bytes by Path all grouped by backend_target_name. \nIt is intended to be used with a dashboard-wide filter on backend_target_name.",
  "gridLayout": {
    "columns": "2",
    "widgets": [
      {
        "title": "Backend Request Count by Path",
        "id": "",
        "xyChart": {
          "chartOptions": {
            "displayHorizontal": false,
            "mode": "COLOR",
            "showLegend": false
          },
          "dataSets": [
            {
              "breakdowns": [],
              "dimensions": [],
              "legendTemplate": "",
              "measures": [],
              "minAlignmentPeriod": "60s",
              "plotType": "LINE",
              "targetAxis": "Y1",
              "timeSeriesQuery": {
                "outputFullDuration": false,
                "timeSeriesFilter": {
                  "aggregation": {
                    "alignmentPeriod": "60s",
                    "crossSeriesReducer": "REDUCE_SUM",
                    "groupByFields": [
                      "resource.label.\"url_map_name\"",
                      "resource.label.\"backend_target_name\"",
                      "resource.label.\"matched_url_path_rule\""
                    ],
                    "perSeriesAligner": "ALIGN_RATE"
                  },
                  "filter": "metric.type=\"loadbalancing.googleapis.com/https/backend_request_count\" resource.type=\"https_lb_rule\""
                },
                "unitOverride": ""
              }
            }
          ],
          "thresholds": [],
          "timeshiftDuration": "0s",
          "yAxis": {
            "label": "",
            "scale": "LINEAR"
          }
        }
      },
      {
        "title": "VM Instance - CPU utilization for e2-micro [MEAN]",
        "id": "",
        "xyChart": {
          "chartOptions": {
            "displayHorizontal": false,
            "mode": "COLOR",
            "showLegend": false
          },
          "dataSets": [
            {
              "breakdowns": [],
              "dimensions": [],
              "legendTemplate": "",
              "measures": [],
              "minAlignmentPeriod": "60s",
              "plotType": "LINE",
              "targetAxis": "Y1",
              "timeSeriesQuery": {
                "outputFullDuration": false,
                "timeSeriesFilter": {
                  "aggregation": {
                    "alignmentPeriod": "60s",
                    "crossSeriesReducer": "REDUCE_MEAN",
                    "groupByFields": [
                      "metadata.system_labels.\"instance_group\""
                    ],
                    "perSeriesAligner": "ALIGN_MEAN"
                  },
                  "filter": "metric.type=\"compute.googleapis.com/instance/cpu/utilization\" resource.type=\"gce_instance\" metadata.system_labels.\"machine_type\"=\"e2-micro\""
                },
                "unitOverride": ""
              }
            }
          ],
          "thresholds": [],
          "yAxis": {
            "label": "",
            "scale": "LINEAR"
          }
        }
      },
      {
        "title": "Error Count by Path and Code",
        "id": "",
        "xyChart": {
          "chartOptions": {
            "displayHorizontal": false,
            "mode": "COLOR",
            "showLegend": false
          },
          "dataSets": [
            {
              "breakdowns": [],
              "dimensions": [],
              "legendTemplate": "",
              "measures": [],
              "plotType": "LINE",
              "targetAxis": "Y1",
              "timeSeriesQuery": {
                "outputFullDuration": false,
                "prometheusQuery": "sum by (\n  matched_url_path_rule,\n  backend_target_name,\n  response_code\n) (\n  increase(\n    loadbalancing_googleapis_com:https_backend_request_count{response_code_class=\"500\", monitored_resource=\"https_lb_rule\"}[${__interval}]\n  )\n)\n",
                "unitOverride": "1"
              }
            }
          ],
          "thresholds": [],
          "timeshiftDuration": "0s",
          "yAxis": {
            "label": "",
            "scale": "LINEAR"
          }
        }
      },
      {
        "title": "Serving capacity & Utilization",
        "id": "",
        "xyChart": {
          "chartOptions": {
            "displayHorizontal": false,
            "mode": "COLOR",
            "showLegend": false
          },
          "dataSets": [
            {
              "breakdowns": [],
              "dimensions": [],
              "legendTemplate": "",
              "measures": [],
              "minAlignmentPeriod": "60s",
              "plotType": "LINE",
              "targetAxis": "Y1",
              "timeSeriesQuery": {
                "outputFullDuration": false,
                "timeSeriesFilter": {
                  "aggregation": {
                    "alignmentPeriod": "60s",
                    "groupByFields": [],
                    "perSeriesAligner": "ALIGN_MEAN"
                  },
                  "filter": "metric.type=\"autoscaler.googleapis.com/capacity\" resource.type=\"autoscaler\""
                },
                "unitOverride": ""
              }
            },
            {
              "breakdowns": [],
              "dimensions": [],
              "legendTemplate": "",
              "measures": [],
              "minAlignmentPeriod": "60s",
              "plotType": "LINE",
              "targetAxis": "Y1",
              "timeSeriesQuery": {
                "outputFullDuration": false,
                "timeSeriesFilter": {
                  "aggregation": {
                    "alignmentPeriod": "60s",
                    "groupByFields": [],
                    "perSeriesAligner": "ALIGN_MEAN"
                  },
                  "filter": "metric.type=\"autoscaler.googleapis.com/current_utilization\" resource.type=\"autoscaler\""
                },
                "unitOverride": ""
              }
            }
          ],
          "thresholds": [],
          "timeshiftDuration": "0s",
          "yAxis": {
            "label": "",
            "scale": "LINEAR"
          }
        }
      },
      {
        "title": "Backend Latency",
        "id": "",
        "xyChart": {
          "chartOptions": {
            "displayHorizontal": false,
            "mode": "COLOR",
            "showLegend": false
          },
          "dataSets": [
            {
              "breakdowns": [],
              "dimensions": [],
              "legendTemplate": "",
              "measures": [],
              "minAlignmentPeriod": "60s",
              "plotType": "LINE",
              "targetAxis": "Y1",
              "timeSeriesQuery": {
                "outputFullDuration": false,
                "timeSeriesFilter": {
                  "aggregation": {
                    "alignmentPeriod": "60s",
                    "crossSeriesReducer": "REDUCE_PERCENTILE_95",
                    "groupByFields": [
                      "resource.label.\"url_map_name\"",
                      "resource.label.\"backend_target_name\""
                    ],
                    "perSeriesAligner": "ALIGN_DELTA"
                  },
                  "filter": "metric.type=\"loadbalancing.googleapis.com/https/backend_latencies\" resource.type=\"https_lb_rule\""
                },
                "unitOverride": ""
              }
            },
            {
              "breakdowns": [],
              "dimensions": [],
              "legendTemplate": "",
              "measures": [],
              "minAlignmentPeriod": "60s",
              "plotType": "LINE",
              "targetAxis": "Y1",
              "timeSeriesQuery": {
                "outputFullDuration": false,
                "timeSeriesFilter": {
                  "aggregation": {
                    "alignmentPeriod": "60s",
                    "crossSeriesReducer": "REDUCE_PERCENTILE_05",
                    "groupByFields": [],
                    "perSeriesAligner": "ALIGN_DELTA"
                  },
                  "filter": "metric.type=\"loadbalancing.googleapis.com/https/backend_latencies\" resource.type=\"https_lb_rule\""
                },
                "unitOverride": ""
              }
            },
            {
              "breakdowns": [],
              "dimensions": [],
              "legendTemplate": "",
              "measures": [],
              "minAlignmentPeriod": "60s",
              "plotType": "LINE",
              "targetAxis": "Y1",
              "timeSeriesQuery": {
                "outputFullDuration": false,
                "timeSeriesFilter": {
                  "aggregation": {
                    "alignmentPeriod": "60s",
                    "crossSeriesReducer": "REDUCE_PERCENTILE_50",
                    "groupByFields": [],
                    "perSeriesAligner": "ALIGN_DELTA"
                  },
                  "filter": "metric.type=\"loadbalancing.googleapis.com/https/backend_latencies\" resource.type=\"https_lb_rule\""
                },
                "unitOverride": ""
              }
            }
          ],
          "thresholds": [],
          "timeshiftDuration": "0s",
          "yAxis": {
            "label": "",
            "scale": "LINEAR"
          }
        }
      },
      {
        "title": "Instance group size per MIG",
        "id": "",
        "xyChart": {
          "chartOptions": {
            "displayHorizontal": false,
            "mode": "COLOR",
            "showLegend": false
          },
          "dataSets": [
            {
              "breakdowns": [],
              "dimensions": [],
              "legendTemplate": "",
              "measures": [],
              "minAlignmentPeriod": "60s",
              "plotType": "STACKED_AREA",
              "targetAxis": "Y1",
              "timeSeriesQuery": {
                "outputFullDuration": false,
                "timeSeriesFilter": {
                  "aggregation": {
                    "alignmentPeriod": "60s",
                    "groupByFields": [],
                    "perSeriesAligner": "ALIGN_MEAN"
                  },
                  "filter": "metric.type=\"compute.googleapis.com/instance_group/size\" resource.type=\"instance_group\""
                },
                "unitOverride": ""
              }
            }
          ],
          "thresholds": [
            {
              "color": "COLOR_UNSPECIFIED",
              "direction": "DIRECTION_UNSPECIFIED",
              "label": "",
              "targetAxis": "Y1",
              "value": 2
            },
            {
              "color": "COLOR_UNSPECIFIED",
              "direction": "DIRECTION_UNSPECIFIED",
              "label": "",
              "targetAxis": "Y1",
              "value": 3
            }
          ],
          "yAxis": {
            "label": "",
            "scale": "LINEAR"
          }
        }
      }
    ]
  }
}